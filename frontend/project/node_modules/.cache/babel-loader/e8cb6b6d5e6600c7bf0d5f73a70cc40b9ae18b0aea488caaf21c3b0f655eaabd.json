{"ast":null,"code":"import { ref, watch } from 'vue';\nimport { ElMessage, ElNotification } from 'element-plus';\nexport default {\n  __name: 'BusinessInfo',\n  props: {\n    shopInfo: {\n      type: Object,\n      required: true\n    }\n  },\n  emits: ['update-shop-info'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const props = __props;\n    const emits = __emit;\n    const shopInfo = ref({\n      ...props.shopInfo\n    });\n    const originalShopInfo = ref({\n      ...props.shopInfo\n    });\n    watch(() => props.shopInfo, newVal => {\n      shopInfo.value = {\n        ...newVal\n      };\n      originalShopInfo.value = {\n        ...newVal\n      };\n    }, {\n      deep: true\n    });\n    const saveShopInfo = () => {\n      const businessUsers = JSON.parse(localStorage.getItem('businessUsers') || '[]');\n      const userId = localStorage.getItem('userId');\n      if (!userId) {\n        ElMessage.error('用户信息异常，请重新登录');\n        return;\n      }\n      const index = businessUsers.findIndex(u => u.userId === userId);\n      if (index !== -1) {\n        const updatedUser = {\n          ...businessUsers[index],\n          userName: shopInfo.value.name,\n          address: shopInfo.value.address,\n          contact: shopInfo.value.contact,\n          avatar: shopInfo.value.avatar\n        };\n        if (shopInfo.value.password) {\n          updatedUser.password = shopInfo.value.password;\n        }\n        businessUsers[index] = updatedUser;\n        localStorage.setItem('businessUsers', JSON.stringify(businessUsers));\n        localStorage.setItem('userName', shopInfo.value.name);\n        originalShopInfo.value = {\n          ...shopInfo.value\n        };\n        emits('update-shop-info', {\n          name: shopInfo.value.name,\n          address: shopInfo.value.address,\n          contact: shopInfo.value.contact,\n          avatar: shopInfo.value.avatar\n        });\n        ElNotification.success({\n          title: '保存成功',\n          message: '商家信息已更新',\n          duration: 2000\n        });\n        shopInfo.value.password = '';\n      } else {\n        ElMessage.error('未找到商家信息，请重新登录');\n      }\n    };\n    const resetForm = () => {\n      shopInfo.value = {\n        ...originalShopInfo.value\n      };\n      shopInfo.value.password = '';\n      ElMessage.info('已重置修改内容');\n    };\n    const handleAvatarChange = file => {\n      if (!file) return;\n      const rawFile = file.raw;\n      if (rawFile) {\n        const reader = new FileReader();\n        reader.onload = e => {\n          shopInfo.value.avatar = e.target.result;\n        };\n        reader.readAsDataURL(rawFile);\n      }\n    };\n    const __returned__ = {\n      props,\n      emits,\n      shopInfo,\n      originalShopInfo,\n      saveShopInfo,\n      resetForm,\n      handleAvatarChange,\n      ref,\n      watch,\n      get ElMessage() {\n        return ElMessage;\n      },\n      get ElNotification() {\n        return ElNotification;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","watch","ElMessage","ElNotification","props","__props","emits","__emit","shopInfo","originalShopInfo","newVal","value","deep","saveShopInfo","businessUsers","JSON","parse","localStorage","getItem","userId","error","index","findIndex","u","updatedUser","userName","name","address","contact","avatar","password","setItem","stringify","success","title","message","duration","resetForm","info","handleAvatarChange","file","rawFile","raw","reader","FileReader","onload","e","target","result","readAsDataURL"],"sources":["E:/实验例子/project/src/views/business/BusinessInfo.vue"],"sourcesContent":["<template>\r\n  <div class=\"info-section\">\r\n    <h2><i class=\"el-icon-user\"></i> 商家信息管理</h2>\r\n    <el-card class=\"info-card\">\r\n      <el-form label-width=\"120px\">\r\n        <el-form-item label=\"商家ID\">\r\n          <el-input v-model=\"shopInfo.id\" disabled />\r\n          <div class=\"info-tip\">商家ID不可更改</div>\r\n        </el-form-item>\r\n        <el-form-item label=\"商家名称\">\r\n          <el-input v-model=\"shopInfo.name\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"登录密码\">\r\n          <el-input \r\n            v-model=\"shopInfo.password\" \r\n            type=\"password\" \r\n            show-password\r\n            placeholder=\"请输入新密码\" \r\n          />\r\n          <div class=\"info-tip\">留空则不修改密码</div>\r\n        </el-form-item>\r\n        <el-form-item label=\"商家地址\">\r\n          <el-input v-model=\"shopInfo.address\" placeholder=\"请输入商家地址\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"联系方式\">\r\n          <el-input v-model=\"shopInfo.contact\" placeholder=\"请输入联系电话\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"商家头像\">\r\n          <div class=\"avatar-upload\">\r\n            <el-avatar \r\n              :size=\"120\" \r\n              :src=\"shopInfo.avatar\" \r\n              class=\"avatar-preview\"\r\n            />\r\n            <div class=\"avatar-actions\">\r\n              <el-upload\r\n                action=\"#\"\r\n                :show-file-list=\"false\"\r\n                :auto-upload=\"false\"\r\n                :on-change=\"handleAvatarChange\"\r\n              >\r\n                <el-button type=\"primary\" icon=\"el-icon-upload\" size=\"small\">上传头像</el-button>\r\n              </el-upload>\r\n              <el-button \r\n                v-if=\"shopInfo.avatar\" \r\n                type=\"danger\" \r\n                icon=\"el-icon-delete\" \r\n                size=\"small\"\r\n                @click=\"shopInfo.avatar = ''\"\r\n              >\r\n                移除\r\n              </el-button>\r\n            </div>\r\n          </div>\r\n        </el-form-item>\r\n        <div class=\"form-actions\">\r\n          <el-button type=\"primary\" @click=\"saveShopInfo\">\r\n            <i class=\"el-icon-check\"></i> 保存修改\r\n          </el-button>\r\n          <el-button @click=\"resetForm\">\r\n            <i class=\"el-icon-refresh\"></i> 重置修改\r\n          </el-button>\r\n        </div>\r\n      </el-form>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, defineProps, defineEmits, watch } from 'vue'\r\nimport { ElMessage, ElNotification } from 'element-plus'\r\n\r\nconst props = defineProps({\r\n  shopInfo: {\r\n    type: Object,\r\n    required: true\r\n  }\r\n})\r\n\r\nconst emits = defineEmits(['update-shop-info'])\r\n\r\nconst shopInfo = ref({ ...props.shopInfo })\r\nconst originalShopInfo = ref({ ...props.shopInfo })\r\n\r\nwatch(() => props.shopInfo, (newVal) => {\r\n  shopInfo.value = { ...newVal }\r\n  originalShopInfo.value = { ...newVal }\r\n}, { deep: true })\r\n\r\nconst saveShopInfo = () => {\r\n  const businessUsers = JSON.parse(localStorage.getItem('businessUsers') || '[]')\r\n  const userId = localStorage.getItem('userId')\r\n  \r\n  if (!userId) {\r\n    ElMessage.error('用户信息异常，请重新登录')\r\n    return\r\n  }\r\n  \r\n  const index = businessUsers.findIndex(u => u.userId === userId)\r\n  \r\n  if (index !== -1) {\r\n    const updatedUser = {\r\n      ...businessUsers[index],\r\n      userName: shopInfo.value.name,\r\n      address: shopInfo.value.address,\r\n      contact: shopInfo.value.contact,\r\n      avatar: shopInfo.value.avatar\r\n    }\r\n    \r\n    if (shopInfo.value.password) {\r\n      updatedUser.password = shopInfo.value.password\r\n    }\r\n    \r\n    businessUsers[index] = updatedUser\r\n    localStorage.setItem('businessUsers', JSON.stringify(businessUsers))\r\n    localStorage.setItem('userName', shopInfo.value.name)\r\n    \r\n    originalShopInfo.value = { ...shopInfo.value }\r\n    \r\n    emits('update-shop-info', {\r\n      name: shopInfo.value.name,\r\n      address: shopInfo.value.address,\r\n      contact: shopInfo.value.contact,\r\n      avatar: shopInfo.value.avatar\r\n    })\r\n    \r\n    ElNotification.success({\r\n      title: '保存成功',\r\n      message: '商家信息已更新',\r\n      duration: 2000\r\n    })\r\n    \r\n    shopInfo.value.password = ''\r\n  } else {\r\n    ElMessage.error('未找到商家信息，请重新登录')\r\n  }\r\n}\r\n\r\nconst resetForm = () => {\r\n  shopInfo.value = { ...originalShopInfo.value }\r\n  shopInfo.value.password = ''\r\n  ElMessage.info('已重置修改内容')\r\n}\r\n\r\nconst handleAvatarChange = (file) => {\r\n  if (!file) return\r\n  const rawFile = file.raw\r\n  if (rawFile) {\r\n    const reader = new FileReader()\r\n    reader.onload = (e) => {\r\n      shopInfo.value.avatar = e.target.result\r\n    }\r\n    reader.readAsDataURL(rawFile)\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.info-section h2 {\r\n  margin-top: 0;\r\n  margin-bottom: 25px;\r\n  color: #303133;\r\n  font-size: 22px;\r\n  font-weight: 600;\r\n  display: flex;\r\n  align-items: center;\r\n  padding-bottom: 15px;\r\n  border-bottom: 1px solid #ebeef5;\r\n}\r\n\r\n.info-section h2 i {\r\n  margin-right: 12px;\r\n  font-size: 24px;\r\n  color: #409eff;\r\n}\r\n\r\n.info-card {\r\n  border-radius: 10px;\r\n  box-shadow: 0 4px 12px rgba(0,0,0,0.05);\r\n  border: none;\r\n}\r\n\r\n.avatar-upload {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 25px;\r\n}\r\n\r\n.avatar-preview {\r\n  border: 1px dashed #dcdfe6;\r\n  border-radius: 8px;\r\n  background-color: #f8f9fa;\r\n}\r\n\r\n.avatar-actions {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 10px;\r\n}\r\n\r\n.info-tip {\r\n  font-size: 12px;\r\n  color: #909399;\r\n  margin-top: 5px;\r\n}\r\n\r\n.form-actions {\r\n  display: flex;\r\n  justify-content: center;\r\n  gap: 20px;\r\n  margin-top: 30px;\r\n}\r\n\r\n.form-actions .el-button {\r\n  padding: 12px 30px;\r\n  font-size: 16px;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}