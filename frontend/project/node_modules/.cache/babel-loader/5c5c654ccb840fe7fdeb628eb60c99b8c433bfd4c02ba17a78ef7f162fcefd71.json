{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nimport \"core-js/modules/es.set.difference.v2.js\";\nimport \"core-js/modules/es.set.intersection.v2.js\";\nimport \"core-js/modules/es.set.is-disjoint-from.v2.js\";\nimport \"core-js/modules/es.set.is-subset-of.v2.js\";\nimport \"core-js/modules/es.set.is-superset-of.v2.js\";\nimport \"core-js/modules/es.set.symmetric-difference.v2.js\";\nimport \"core-js/modules/es.set.union.v2.js\";\n// stores/cart.js\nimport { defineStore } from 'pinia';\nimport { ref, computed } from 'vue';\nexport const useCartStore = defineStore('cart', () => {\n  // 增强localStorage读取健壮性\n  const initialCart = () => {\n    try {\n      return JSON.parse(localStorage.getItem('cart')) || [];\n    } catch (error) {\n      console.error('购物车数据解析失败:', error);\n      return [];\n    }\n  };\n  const items = ref(initialCart());\n  const selectedItems = ref(new Set());\n\n  // 添加商品\n  const addItem = item => {\n    const existing = items.value.find(i => i.id === item.id);\n    if (existing) {\n      existing.quantity += Number(item.quantity) || 1;\n    } else {\n      items.value.push({\n        id: item.id,\n        name: item.name || '未知商品',\n        price: Number(item.price) || 0,\n        // 强制转换为数字\n        quantity: Math.max(1, Number(item.quantity) || 1),\n        image: item.image || '/placeholder-product.jpg'\n      });\n    }\n    persistCart();\n  };\n\n  // 移除商品\n  const removeItem = id => {\n    items.value = items.value.filter(i => i.id !== id);\n    selectedItems.value.delete(id); // 同时从选中项中移除\n    persistCart();\n  };\n\n  // 批量移除商品\n  const removeItems = ids => {\n    items.value = items.value.filter(i => !ids.includes(i.id));\n    ids.forEach(id => selectedItems.value.delete(id));\n    persistCart();\n  };\n\n  // 持久化存储\n  const persistCart = () => {\n    localStorage.setItem('cart', JSON.stringify(items.value));\n  };\n\n  // 总价计算（增强数值安全）\n  const totalPrice = computed(() => items.value.reduce((sum, item) => {\n    const price = Number(item.price) || 0;\n    const quantity = Number(item.quantity) || 1;\n    return sum + price * quantity;\n  }, 0));\n\n  // 选中商品总价\n  const selectedTotalPrice = computed(() => items.value.reduce((sum, item) => {\n    if (selectedItems.value.has(item.id)) {\n      const price = Number(item.price) || 0;\n      const quantity = Number(item.quantity) || 1;\n      return sum + price * quantity;\n    }\n    return sum;\n  }, 0));\n\n  // 选中的商品列表\n  const selectedItemsList = computed(() => items.value.filter(item => selectedItems.value.has(item.id)));\n  const toggleSelection = id => {\n    if (selectedItems.value.has(id)) {\n      selectedItems.value.delete(id);\n    } else {\n      selectedItems.value.add(id);\n    }\n    persistCart();\n  };\n\n  // 全选/取消全选\n  const toggleSelectAll = () => {\n    if (selectedItems.value.size === items.value.length) {\n      selectedItems.value.clear();\n    } else {\n      items.value.forEach(item => selectedItems.value.add(item.id));\n    }\n    persistCart();\n  };\n  const clearSelected = () => selectedItems.value.clear();\n  return {\n    items: computed(() => items.value),\n    totalPrice,\n    selectedTotalPrice,\n    selectedItems: computed(() => selectedItems.value),\n    selectedItemsList,\n    addItem,\n    removeItem,\n    removeItems,\n    toggleSelection,\n    toggleSelectAll,\n    clearSelected\n  };\n});","map":{"version":3,"names":["defineStore","ref","computed","useCartStore","initialCart","JSON","parse","localStorage","getItem","error","console","items","selectedItems","Set","addItem","item","existing","value","find","i","id","quantity","Number","push","name","price","Math","max","image","persistCart","removeItem","filter","delete","removeItems","ids","includes","forEach","setItem","stringify","totalPrice","reduce","sum","selectedTotalPrice","has","selectedItemsList","toggleSelection","add","toggleSelectAll","size","length","clear","clearSelected"],"sources":["E:/实验例子/project/src/stores/cart.js"],"sourcesContent":["// stores/cart.js\r\nimport { defineStore } from 'pinia'\r\nimport { ref, computed } from 'vue'\r\n\r\nexport const useCartStore = defineStore('cart', () => {\r\n  \r\n  // 增强localStorage读取健壮性\r\n  const initialCart = () => {\r\n    try {\r\n      return JSON.parse(localStorage.getItem('cart')) || []\r\n    } catch (error) {\r\n      console.error('购物车数据解析失败:', error)\r\n      return []\r\n    }\r\n  }\r\n\r\n  const items = ref(initialCart())\r\n  const selectedItems = ref(new Set())\r\n  \r\n  // 添加商品\r\n  const addItem = (item) => {\r\n    const existing = items.value.find(i => i.id === item.id)\r\n    if (existing) {\r\n      existing.quantity += Number(item.quantity) || 1\r\n    } else {\r\n      items.value.push({\r\n        id: item.id,\r\n        name: item.name || '未知商品',\r\n        price: Number(item.price) || 0, // 强制转换为数字\r\n        quantity: Math.max(1, Number(item.quantity) || 1),\r\n        image: item.image || '/placeholder-product.jpg'\r\n      })\r\n    }\r\n    persistCart()\r\n  }\r\n\r\n  // 移除商品\r\n  const removeItem = (id) => {\r\n    items.value = items.value.filter(i => i.id !== id)\r\n    selectedItems.value.delete(id) // 同时从选中项中移除\r\n    persistCart()\r\n  }\r\n  \r\n  // 批量移除商品\r\n  const removeItems = (ids) => {\r\n    items.value = items.value.filter(i => !ids.includes(i.id))\r\n    ids.forEach(id => selectedItems.value.delete(id))\r\n    persistCart()\r\n  }\r\n\r\n  // 持久化存储\r\n  const persistCart = () => {\r\n    localStorage.setItem('cart', JSON.stringify(items.value))\r\n  }\r\n\r\n  // 总价计算（增强数值安全）\r\n  const totalPrice = computed(() => \r\n    items.value.reduce((sum, item) => {\r\n      const price = Number(item.price) || 0\r\n      const quantity = Number(item.quantity) || 1\r\n      return sum + (price * quantity)\r\n    }, 0)\r\n  )\r\n  \r\n  // 选中商品总价\r\n  const selectedTotalPrice = computed(() => \r\n    items.value.reduce((sum, item) => {\r\n      if (selectedItems.value.has(item.id)) {\r\n        const price = Number(item.price) || 0\r\n        const quantity = Number(item.quantity) || 1\r\n        return sum + (price * quantity)\r\n      }\r\n      return sum\r\n    }, 0)\r\n  )\r\n  \r\n  // 选中的商品列表\r\n  const selectedItemsList = computed(() => \r\n    items.value.filter(item => selectedItems.value.has(item.id))\r\n  )\r\n\r\n  const toggleSelection = (id) => {\r\n    if (selectedItems.value.has(id)) {\r\n      selectedItems.value.delete(id)\r\n    } else {\r\n      selectedItems.value.add(id)\r\n    }\r\n    persistCart()\r\n  }\r\n  \r\n  // 全选/取消全选\r\n  const toggleSelectAll = () => {\r\n    if (selectedItems.value.size === items.value.length) {\r\n      selectedItems.value.clear()\r\n    } else {\r\n      items.value.forEach(item => selectedItems.value.add(item.id))\r\n    }\r\n    persistCart()\r\n  }\r\n\r\n  const clearSelected = () => selectedItems.value.clear()\r\n\r\n  return {\r\n    items: computed(() => items.value),\r\n    totalPrice,\r\n    selectedTotalPrice,\r\n    selectedItems: computed(() => selectedItems.value),\r\n    selectedItemsList,\r\n    addItem,\r\n    removeItem,\r\n    removeItems,\r\n    toggleSelection,\r\n    toggleSelectAll,\r\n    clearSelected\r\n  }\r\n})"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}