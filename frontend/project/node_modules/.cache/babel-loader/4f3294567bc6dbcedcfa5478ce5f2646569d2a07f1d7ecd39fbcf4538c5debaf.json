{"ast":null,"code":"import { ref, computed, onMounted } from 'vue';\nimport { useRoute } from 'vue-router';\nimport { ElMessage } from 'element-plus';\nexport default {\n  __name: 'ProductDetail',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const route = useRoute();\n    const productData = ref(null);\n    const loading = ref(true);\n    const activeTab = ref(0);\n\n    // 格式化价格显示\n    const formatPrice = price => {\n      return Number(price || 0).toFixed(2);\n    };\n\n    // 计算好评率\n    const goodRatePercentage = computed(() => {\n      const evaluation = productData.value?.evaluationInfo;\n      if (!evaluation) return 0;\n      return (evaluation.goodCount / evaluation.total * 100).toFixed(1);\n    });\n\n    // 获取商品详情\n    onMounted(async () => {\n      try {\n        const response = await fetch(`http://pcapi-xiaotuxian-front-devtest.itheima.net/goods?id=${route.params.id}`);\n        const res = await response.json();\n        if (res.code !== 1) {\n          throw new Error(res.msg || '获取商品信息失败');\n        }\n        productData.value = {\n          ...res.result,\n          // 处理分类数据\n          categories: res.result.categories || [],\n          // 处理品牌数据\n          brand: res.result.brand || null,\n          // 处理评价数据\n          evaluationInfo: res.result.evaluationInfo || null\n        };\n      } catch (error) {\n        ElMessage.error(error.message);\n      } finally {\n        loading.value = false;\n      }\n    });\n    const __returned__ = {\n      route,\n      productData,\n      loading,\n      activeTab,\n      formatPrice,\n      goodRatePercentage,\n      ref,\n      computed,\n      onMounted,\n      get useRoute() {\n        return useRoute;\n      },\n      get ElMessage() {\n        return ElMessage;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","useRoute","ElMessage","route","productData","loading","activeTab","formatPrice","price","Number","toFixed","goodRatePercentage","evaluation","value","evaluationInfo","goodCount","total","response","fetch","params","id","res","json","code","Error","msg","result","categories","brand","error","message"],"sources":["E:/实验例子/project/src/views/Buyer/ProductDetail.vue"],"sourcesContent":["<template>\r\n  <div class=\"product-detail\">\r\n    <el-button type=\"text\" icon=\"ArrowLeft\" @click=\"$router.go(-1)\">返回</el-button>\r\n    \r\n    <div class=\"detail-container\" v-loading=\"loading\">\r\n      <!-- 商品图片轮播 -->\r\n      <el-carousel v-if=\"productData?.pictures\" height=\"500px\">\r\n        <el-carousel-item v-for=\"(img, index) in productData.pictures\" :key=\"index\">\r\n          <el-image \r\n            :src=\"img\" \r\n            fit=\"contain\" \r\n            style=\"width: 100%; height: 100%\"\r\n          />\r\n        </el-carousel-item>\r\n      </el-carousel>\r\n\r\n      <!-- 商品信息 -->\r\n      <div class=\"product-info\">\r\n        <h1 class=\"product-title\">{{ productData.name }}</h1>\r\n        <div class=\"product-meta\">\r\n          <el-tag type=\"success\">销量 {{ productData.salesCount }}</el-tag>\r\n          <el-tag>收藏 {{ productData.collectCount }}</el-tag>\r\n          <el-tag>评论 {{ productData.commentCount }}</el-tag>\r\n        </div>\r\n\r\n        <div class=\"price-section\">\r\n          <span class=\"current-price\">¥{{ formatPrice(productData.price) }}</span>\r\n          <span class=\"inventory\">库存 {{ productData.inventory }} 件</span>\r\n        </div>\r\n\r\n        <div class=\"category-path\">\r\n          <el-breadcrumb separator=\"/\">\r\n            <el-breadcrumb-item \r\n              v-for=\"(category, index) in productData.categories\" \r\n              :key=\"index\"\r\n            >\r\n              {{ category.name }}\r\n            </el-breadcrumb-item>\r\n          </el-breadcrumb>\r\n        </div>\r\n\r\n        <div class=\"brand-info\" v-if=\"productData.brand\">\r\n          <el-image \r\n            :src=\"productData.brand.logo\" \r\n            fit=\"contain\" \r\n            style=\"width: 100px; height: 40px\"\r\n          />\r\n          <span>{{ productData.brand.name }}</span>\r\n        </div>\r\n\r\n        <el-divider />\r\n\r\n        <!-- 商品描述 -->\r\n        <div class=\"product-desc\">\r\n          <h3>商品详情</h3>\r\n          <div v-html=\"productData.desc\"></div>\r\n        </div>\r\n\r\n        <!-- 评价信息 -->\r\n        <div class=\"evaluation-section\" v-if=\"productData.evaluationInfo\">\r\n          <h3>商品评价（{{ productData.commentCount }}条）</h3>\r\n          <div class=\"rate-overview\">\r\n            <span>好评率：{{ goodRatePercentage }}%</span>\r\n            <el-rate \r\n              v-model=\"productData.evaluationInfo.average\" \r\n              disabled\r\n              show-score\r\n              :colors=\"['#f56c6c', '#f56c6c', '#f56c6c']\"\r\n            />\r\n          </div>\r\n          \r\n          <el-tabs v-model=\"activeTab\">\r\n            <el-tab-pane \r\n              v-for=\"tag in productData.evaluationInfo.tags\" \r\n              :key=\"tag.title\"\r\n              :label=\"`${tag.title}（${tag.count}）`\"\r\n            >\r\n              <div class=\"comment-list\">\r\n                <div \r\n                  class=\"comment-item\" \r\n                  v-for=\"comment in tag.comments\" \r\n                  :key=\"comment.id\"\r\n                >\r\n                  <div class=\"user-info\">\r\n                    <span>{{ comment.nickname }}</span>\r\n                    <el-rate \r\n                      v-model=\"comment.rating\" \r\n                      disabled \r\n                      size=\"small\"\r\n                    />\r\n                  </div>\r\n                  <p class=\"content\">{{ comment.content }}</p>\r\n                  <div class=\"images\" v-if=\"comment.pictures\">\r\n                    <el-image\r\n                      v-for=\"(img, idx) in comment.pictures\"\r\n                      :key=\"idx\"\r\n                      :src=\"img\"\r\n                      style=\"width: 100px; height: 100px; margin-right: 10px\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </el-tab-pane>\r\n          </el-tabs>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, onMounted } from 'vue'\r\nimport { useRoute } from 'vue-router'\r\nimport { ElMessage } from 'element-plus'\r\n\r\nconst route = useRoute()\r\nconst productData = ref(null)\r\nconst loading = ref(true)\r\nconst activeTab = ref(0)\r\n\r\n// 格式化价格显示\r\nconst formatPrice = (price) => {\r\n  return Number(price || 0).toFixed(2)\r\n}\r\n\r\n// 计算好评率\r\nconst goodRatePercentage = computed(() => {\r\n  const evaluation = productData.value?.evaluationInfo\r\n  if (!evaluation) return 0\r\n  return ((evaluation.goodCount / evaluation.total) * 100).toFixed(1)\r\n})\r\n\r\n// 获取商品详情\r\nonMounted(async () => {\r\n  try {\r\n    const response = await fetch(\r\n      `http://pcapi-xiaotuxian-front-devtest.itheima.net/goods?id=${route.params.id}`\r\n    )\r\n    const res = await response.json()\r\n    \r\n    if (res.code !== 1) {\r\n      throw new Error(res.msg || '获取商品信息失败')\r\n    }\r\n\r\n    productData.value = {\r\n      ...res.result,\r\n      // 处理分类数据\r\n      categories: res.result.categories || [],\r\n      // 处理品牌数据\r\n      brand: res.result.brand || null,\r\n      // 处理评价数据\r\n      evaluationInfo: res.result.evaluationInfo || null\r\n    }\r\n  } catch (error) {\r\n    ElMessage.error(error.message)\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.detail-container {\r\n  max-width: 1200px;\r\n  margin: 20px auto;\r\n  display: grid;\r\n  grid-template-columns: 1fr 1fr;\r\n  gap: 40px;\r\n}\r\n\r\n.product-title {\r\n  font-size: 24px;\r\n  margin-bottom: 15px;\r\n}\r\n\r\n.product-meta {\r\n  margin: 15px 0;\r\n  display: flex;\r\n  gap: 10px;\r\n}\r\n\r\n.price-section {\r\n  padding: 20px 0;\r\n  background: #f5f7fa;\r\n  border-radius: 4px;\r\n  margin: 20px 0;\r\n}\r\n\r\n.current-price {\r\n  font-size: 28px;\r\n  color: #f56c6c;\r\n  margin-right: 30px;\r\n}\r\n\r\n.inventory {\r\n  color: #606266;\r\n}\r\n\r\n.category-path {\r\n  margin: 15px 0;\r\n}\r\n\r\n.brand-info {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 10px;\r\n  margin: 15px 0;\r\n}\r\n\r\n.evaluation-section {\r\n  margin-top: 30px;\r\n}\r\n\r\n.rate-overview {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 20px;\r\n  margin: 15px 0;\r\n}\r\n\r\n.comment-item {\r\n  padding: 15px 0;\r\n  border-bottom: 1px solid #ebeef5;\r\n}\r\n\r\n.user-info {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 10px;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.content {\r\n  color: #606266;\r\n  line-height: 1.6;\r\n}\r\n\r\n.images {\r\n  margin-top: 10px;\r\n}\r\n</style>"],"mappings":"AA+GA,SAASA,GAAG,EAAEC,QAAQ,EAAEC,SAAS,QAAQ,KAAK;AAC9C,SAASC,QAAQ,QAAQ,YAAY;AACrC,SAASC,SAAS,QAAQ,cAAc;;;;;;;IAExC,MAAMC,KAAK,GAAGF,QAAQ,CAAC,CAAC;IACxB,MAAMG,WAAW,GAAGN,GAAG,CAAC,IAAI,CAAC;IAC7B,MAAMO,OAAO,GAAGP,GAAG,CAAC,IAAI,CAAC;IACzB,MAAMQ,SAAS,GAAGR,GAAG,CAAC,CAAC,CAAC;;IAExB;IACA,MAAMS,WAAW,GAAIC,KAAK,IAAK;MAC7B,OAAOC,MAAM,CAACD,KAAK,IAAI,CAAC,CAAC,CAACE,OAAO,CAAC,CAAC,CAAC;IACtC,CAAC;;IAED;IACA,MAAMC,kBAAkB,GAAGZ,QAAQ,CAAC,MAAM;MACxC,MAAMa,UAAU,GAAGR,WAAW,CAACS,KAAK,EAAEC,cAAc;MACpD,IAAI,CAACF,UAAU,EAAE,OAAO,CAAC;MACzB,OAAO,CAAEA,UAAU,CAACG,SAAS,GAAGH,UAAU,CAACI,KAAK,GAAI,GAAG,EAAEN,OAAO,CAAC,CAAC,CAAC;IACrE,CAAC,CAAC;;IAEF;IACAV,SAAS,CAAC,YAAY;MACpB,IAAI;QACF,MAAMiB,QAAQ,GAAG,MAAMC,KAAK,CAC1B,8DAA8Df,KAAK,CAACgB,MAAM,CAACC,EAAE,EAC/E,CAAC;QACD,MAAMC,GAAG,GAAG,MAAMJ,QAAQ,CAACK,IAAI,CAAC,CAAC;QAEjC,IAAID,GAAG,CAACE,IAAI,KAAK,CAAC,EAAE;UAClB,MAAM,IAAIC,KAAK,CAACH,GAAG,CAACI,GAAG,IAAI,UAAU,CAAC;QACxC;QAEArB,WAAW,CAACS,KAAK,GAAG;UAClB,GAAGQ,GAAG,CAACK,MAAM;UACb;UACAC,UAAU,EAAEN,GAAG,CAACK,MAAM,CAACC,UAAU,IAAI,EAAE;UACvC;UACAC,KAAK,EAAEP,GAAG,CAACK,MAAM,CAACE,KAAK,IAAI,IAAI;UAC/B;UACAd,cAAc,EAAEO,GAAG,CAACK,MAAM,CAACZ,cAAc,IAAI;QAC/C,CAAC;MACH,CAAC,CAAC,OAAOe,KAAK,EAAE;QACd3B,SAAS,CAAC2B,KAAK,CAACA,KAAK,CAACC,OAAO,CAAC;MAChC,CAAC,SAAS;QACRzB,OAAO,CAACQ,KAAK,GAAG,KAAK;MACvB;IACF,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}