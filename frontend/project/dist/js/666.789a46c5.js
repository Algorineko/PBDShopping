"use strict";(self["webpackChunkproject"]=self["webpackChunkproject"]||[]).push([[666],{1666:function(e,t,r){r.r(t),r.d(t,{default:function(){return v}});r(8111),r(2489),r(116),r(1701),r(4979);var o=r(6768),a=r(4232),l=r(144),n=r(1219),c=r(2933),i=r(1147);const s={class:"user-reviews"},d={class:"product-list"},u={class:"product-item"},p={class:"product-details"},m={class:"product-price"};var g={__name:"UserReviews",setup(e){const t=(0,l.KR)([]),r=e=>{try{const t=e.split(".")[1],r=t.replace(/-/g,"+").replace(/_/g,"/"),o=decodeURIComponent(atob(r).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join(""));return JSON.parse(o)}catch(t){return console.error("Token解析失败:",t),null}},g=localStorage.getItem("token"),k=(0,o.EW)((()=>{if(g){const e=r(g);return e.sub||"guest"}return"guest"})),b=()=>{const e=localStorage.getItem("token");if(!e)return n.nk.error("用户未登录，请先登录"),null;try{const t=r(e);return t.customerId||null}catch(t){return console.error("Token解析失败:",t),n.nk.error("用户信息解析失败"),null}},v=async()=>{try{const e=b();if(!e)return void n.nk.error("无法获取用户信息");const r=await i.A.get(`http://algorineko.top:8080/api/customer/review/customer/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),o=JSON.parse(localStorage.getItem("productReviews")||"[]");t.value=r.data.map((e=>{const t=o.find((t=>t.orderItemId===e.orderItemId)),r=t?.itemSnapshot||{};return{...e,content:e.comment,date:t?.date||(new Date).toLocaleString(),item:{id:r.id||0,name:r.name||"商品信息缺失",price:r.price||0,quantity:r.quantity||1,image:r.image||"/placeholder-product.jpg"}}}))}catch(e){console.error("加载评价失败:",e),n.nk.error("加载评价失败"),t.value=[]}},h=async e=>{try{await c.s.confirm("确定要删除这个评价吗？删除后无法恢复","警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),await i.A.delete(`http://algorineko.top:8080/api/customer/review/${e.reviewId}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});const t=JSON.parse(localStorage.getItem("productReviews")||"[]"),r=t.filter((t=>t.orderItemId!==e.orderItemId));localStorage.setItem("productReviews",JSON.stringify(r)),v(),n.nk.success("删除成功")}catch(t){"cancel"!==t&&(console.error("删除评价失败:",t),n.nk.error("删除评价失败"))}};return(0,o.sV)(v),(e,r)=>{const l=(0,o.g2)("el-table-column"),n=(0,o.g2)("el-image"),c=(0,o.g2)("router-link"),i=(0,o.g2)("el-rate"),g=(0,o.g2)("el-button"),b=(0,o.g2)("el-table"),v=(0,o.g2)("el-empty");return(0,o.uX)(),(0,o.CE)("div",s,[r[1]||(r[1]=(0,o.Lk)("h2",null,"评价管理",-1)),(0,o.bF)(b,{data:t.value,border:"",style:{width:"100%"}},{default:(0,o.k6)((()=>[(0,o.bF)(l,{prop:"orderItemId",label:"订单项ID",width:"120"}),(0,o.bF)(l,{label:"商品信息"},{default:(0,o.k6)((({row:e})=>[(0,o.Lk)("div",d,[(0,o.Lk)("div",u,[(0,o.bF)(c,{to:`/buyer/${k.value}/product/${e.item.id}`},{default:(0,o.k6)((()=>[(0,o.bF)(n,{src:e.item.image||"/placeholder-product.jpg",style:{width:"60px",height:"60px"},fit:"cover"},null,8,["src"])])),_:2},1032,["to"]),(0,o.Lk)("div",p,[(0,o.bF)(c,{to:`/buyer/${k.value}/product/${e.item.id}`,class:"product-name"},{default:(0,o.k6)((()=>[(0,o.eW)((0,a.v_)(e.item.name||"商品信息缺失"),1)])),_:2},1032,["to"]),(0,o.Lk)("div",m,"¥"+(0,a.v_)((e.item.price||0).toFixed(2))+" × "+(0,a.v_)(e.item.quantity||1),1)])])])])),_:1}),(0,o.bF)(l,{label:"评分",width:"120"},{default:(0,o.k6)((e=>[(0,o.bF)(i,{modelValue:e.row.rating,"onUpdate:modelValue":t=>e.row.rating=t,disabled:"","show-score":"","text-color":"#ff9900"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,o.bF)(l,{prop:"comment",label:"评价内容"}),(0,o.bF)(l,{prop:"date",label:"评价时间",width:"180"}),(0,o.bF)(l,{label:"操作",width:"150"},{default:(0,o.k6)((({row:e})=>[(0,o.bF)(g,{type:"danger",size:"small",onClick:t=>h(e)},{default:(0,o.k6)((()=>r[0]||(r[0]=[(0,o.eW)("删除")]))),_:2,__:[0]},1032,["onClick"])])),_:1})])),_:1},8,["data"]),0===t.value.length?((0,o.uX)(),(0,o.Wv)(v,{key:0,description:"暂无评价记录",class:"empty-tip"})):(0,o.Q3)("",!0)])}}},k=r(1241);const b=(0,k.A)(g,[["__scopeId","data-v-8a25580a"]]);var v=b}}]);
//# sourceMappingURL=666.789a46c5.js.map