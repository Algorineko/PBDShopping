"use strict";(self["webpackChunkproject"]=self["webpackChunkproject"]||[]).push([[483],{5483:function(e,a,t){t.r(a),t.d(a,{default:function(){return g}});var l=t(6768),o=t(144),s=t(1219),r=t(3851),n=t(1147);const u={class:"info-section"},d={class:"avatar-upload"},c={class:"avatar-actions"},i={class:"form-actions"};var p={__name:"BusinessInfo",setup(e){const a=(0,o.KR)({username:"",password:"",address:"",phoneNumber:"",avatar:""}),t=(0,o.KR)(""),p=(0,o.KR)(!1),m=(0,o.KR)({}),v=()=>{const e=localStorage.getItem("token");return!!e||(s.nk.error("用户未登录，请重新登录"),g(),!1)},g=()=>{localStorage.removeItem("token"),setTimeout((()=>{window.location.href="/login"}),1500)},h=async()=>{if(v())try{const e=localStorage.getItem("token"),t=await n.A.get("http://algorineko.top:8080/api/merchants/profile",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},timeout:1e4});console.log("response.data",t.data);const l=t.data.data||t.data;a.value={username:l.merchantName||l.username||"",password:"",address:l.merchantAddress||l.address||"",phoneNumber:l.phoneNumber||"",avatar:l.headPicture||l.avatar||""},l.merchantId?localStorage.setItem("userId",l.merchantId.toString()):l.id&&localStorage.setItem("userId",l.id.toString());const o=localStorage.getItem("userId");if(o){const e=localStorage.getItem(`merchant_avatar_${o}`);e&&(a.value.avatar=e)}m.value={...a.value}}catch(e){console.error("获取商家信息失败:",e);let a="获取商家信息失败，请重试";e.response&&(401===e.response.status?(a="身份验证失败，请重新登录",g()):e.response.data&&e.response.data.message&&(a=e.response.data.message)),s.nk.error(a)}},k=async()=>{if(!v())return;p.value=!0;const e=localStorage.getItem("token");try{if(await n.A.put("http://algorineko.top:8080/api/merchants/putProfile",{merchantAddress:a.value.address,phoneNumber:a.value.phoneNumber},{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},timeout:1e4}),a.value.password){if(!t.value)return s.nk.warning("修改密码需要提供旧密码"),void(p.value=!1);await n.A.put("http://algorineko.top:8080/api/merchants/change-password",{oldPassword:t.value,newPassword:a.value.password},{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},timeout:1e4})}m.value={...a.value},t.value="",a.value.password="",await h(),r.df.success({title:"保存成功",message:"商家信息已更新",duration:2e3})}catch(l){console.error("保存失败:",l);let e="保存失败，请重试";l.response&&(400===l.response.status?e=l.response.data.message||"请求参数错误":401===l.response.status?(e="身份验证失败，请重新登录",g()):403===l.response.status?e="旧密码不正确":l.response.data&&l.response.data.message&&(e=l.response.data.message)),s.nk.error(e)}finally{p.value=!1}},f=()=>{a.value={...m.value},t.value="",a.value.password="",s.nk.info("已重置修改内容")},b=e=>{if(!e)return;const t=e.raw;if(t){const e=new FileReader;e.onload=e=>{a.value.avatar=e.target.result;const t=localStorage.getItem("userId");t&&localStorage.setItem(`merchant_avatar_${t}`,e.target.result)},e.readAsDataURL(t)}},_=()=>{a.value.avatar="";const e=localStorage.getItem("userId");e&&localStorage.removeItem(`merchant_avatar_${e}`)};return(0,l.sV)((()=>{h()})),(e,o)=>{const s=(0,l.g2)("el-input"),r=(0,l.g2)("el-form-item"),n=(0,l.g2)("el-avatar"),m=(0,l.g2)("el-button"),v=(0,l.g2)("el-upload"),g=(0,l.g2)("el-form"),h=(0,l.g2)("el-card");return(0,l.uX)(),(0,l.CE)("div",u,[o[11]||(o[11]=(0,l.Lk)("h2",null,[(0,l.Lk)("i",{class:"el-icon-user"}),(0,l.eW)(" 商家信息管理")],-1)),(0,l.bF)(h,{class:"info-card"},{default:(0,l.k6)((()=>[(0,l.bF)(g,{"label-width":"120px"},{default:(0,l.k6)((()=>[(0,l.bF)(r,{label:"商家用户名"},{default:(0,l.k6)((()=>[(0,l.bF)(s,{modelValue:a.value.username,"onUpdate:modelValue":o[0]||(o[0]=e=>a.value.username=e),disabled:""},null,8,["modelValue"]),o[5]||(o[5]=(0,l.Lk)("div",{class:"info-tip"},"商家用户名不可更改",-1))])),_:1,__:[5]}),(0,l.bF)(r,{label:"旧密码"},{default:(0,l.k6)((()=>[(0,l.bF)(s,{modelValue:t.value,"onUpdate:modelValue":o[1]||(o[1]=e=>t.value=e),type:"password","show-password":"",placeholder:"请输入当前密码"},null,8,["modelValue"])])),_:1}),(0,l.bF)(r,{label:"新密码"},{default:(0,l.k6)((()=>[(0,l.bF)(s,{modelValue:a.value.password,"onUpdate:modelValue":o[2]||(o[2]=e=>a.value.password=e),type:"password","show-password":"",placeholder:"请输入新密码"},null,8,["modelValue"]),o[6]||(o[6]=(0,l.Lk)("div",{class:"info-tip"},"留空则不修改密码",-1))])),_:1,__:[6]}),(0,l.bF)(r,{label:"商家地址"},{default:(0,l.k6)((()=>[(0,l.bF)(s,{modelValue:a.value.address,"onUpdate:modelValue":o[3]||(o[3]=e=>a.value.address=e),placeholder:"请输入商家地址"},null,8,["modelValue"])])),_:1}),(0,l.bF)(r,{label:"联系电话"},{default:(0,l.k6)((()=>[(0,l.bF)(s,{modelValue:a.value.phoneNumber,"onUpdate:modelValue":o[4]||(o[4]=e=>a.value.phoneNumber=e),placeholder:"请输入联系电话"},null,8,["modelValue"])])),_:1}),(0,l.bF)(r,{label:"商家头像"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",d,[(0,l.bF)(n,{size:120,src:a.value.avatar,class:"avatar-preview"},null,8,["src"]),(0,l.Lk)("div",c,[(0,l.bF)(v,{action:"#","show-file-list":!1,"auto-upload":!1,"on-change":b},{default:(0,l.k6)((()=>[(0,l.bF)(m,{type:"primary",icon:"el-icon-upload",size:"small"},{default:(0,l.k6)((()=>o[7]||(o[7]=[(0,l.eW)("上传头像")]))),_:1,__:[7]})])),_:1}),a.value.avatar?((0,l.uX)(),(0,l.Wv)(m,{key:0,type:"danger",icon:"el-icon-delete",size:"small",onClick:_},{default:(0,l.k6)((()=>o[8]||(o[8]=[(0,l.eW)(" 移除 ")]))),_:1,__:[8]})):(0,l.Q3)("",!0)])])])),_:1}),(0,l.Lk)("div",i,[(0,l.bF)(m,{type:"primary",onClick:k,loading:p.value},{default:(0,l.k6)((()=>o[9]||(o[9]=[(0,l.Lk)("i",{class:"el-icon-check"},null,-1),(0,l.eW)(" 保存修改 ")]))),_:1,__:[9]},8,["loading"]),(0,l.bF)(m,{onClick:f},{default:(0,l.k6)((()=>o[10]||(o[10]=[(0,l.Lk)("i",{class:"el-icon-refresh"},null,-1),(0,l.eW)(" 重置修改 ")]))),_:1,__:[10]})])])),_:1})])),_:1})])}}},m=t(1241);const v=(0,m.A)(p,[["__scopeId","data-v-1f605786"]]);var g=v}}]);
//# sourceMappingURL=483.d62f9975.js.map