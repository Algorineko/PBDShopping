"use strict";(self["webpackChunkproject"]=self["webpackChunkproject"]||[]).push([[611],{5934:function(e,t,a){a.d(t,{x:function(){return s}});a(4114),a(8111),a(2489),a(116),a(7588),a(1701),a(8237),a(7642),a(8004),a(3853),a(5876),a(2475),a(5024),a(1698),a(4979);var r=a(2261),o=a(144),l=a(6768),n=a(1147);const c=e=>{try{const t=e.split(".")[1],a=t.replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent(atob(a).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join(""));return JSON.parse(r)}catch(t){return console.error("Token解析失败:",t),null}},s=(0,r.nY)("cart",(()=>{const e=(0,o.KR)([]),t=(0,o.KR)(new Set),a=(0,o.KR)(!1),r=(0,o.KR)(null),s=async e=>{try{const t=await n.A.get(`http://algorineko.top:8080/api/merchant/product/detail/${e}`);return t.data}catch(t){return console.error(`获取商品详情失败 (ID: ${e}):`,t),null}},u=t=>{const a=e.value.find((e=>e.id===t.id));a?a.quantity+=Number(t.quantity)||1:e.value.push({id:t.id,name:t.name||"未知商品",price:Number(t.price)||0,quantity:Math.max(1,Number(t.quantity)||1),image:t.image||"/placeholder-product.jpg",cartItemId:t.cartItemId})},i=async e=>{const t=localStorage.getItem("token");if(!t)throw new Error("请先登录后再添加商品到购物车");const a=c(t);if(!a||!a.customerId)throw new Error("用户信息不完整，请重新登录");const o={customerId:Number(a.customerId),productId:Number(e.id),quantity:Number(e.quantity),selectedOptions:""};try{const a=await n.A.post("http://algorineko.top:8080/api/customer/cart/add",o,{headers:{Authorization:`Bearer ${t}`}});return u({id:e.id,name:e.name,price:e.price,quantity:e.quantity,image:e.image}),a.data}catch(r){let t="加入购物车失败";throw t=r.response?400===r.response.status?r.response.data?.message||"请求参数错误":401===r.response.status?"身份验证失败，请重新登录":500===r.response.status?r.response.data?.message||"服务器内部错误":r.response.data?.message||"未知错误":r.message||"网络错误，请检查连接",new Error(t)}},d=async()=>{a.value=!0,r.value=null;try{const t=localStorage.getItem("token");if(!t)throw new Error("用户未登录");const a=await n.A.get("http://algorineko.top:8080/api/customer/cart/get",{headers:{Authorization:`Bearer ${t}`}}),r=[];for(const e of a.data){const t=await s(e.productId);r.push({id:e.productId,cartItemId:e.cartItemId,name:t?.productName||e.productName||"未知商品",price:Number(t?.price)||Number(e.price)||0,quantity:Math.max(1,Number(e.quantity)||1),image:e.image||"/placeholder-product.jpg"})}e.value=r}catch(t){r.value=t.response?.data?.message||t.message,console.error("获取购物车失败:",t),e.value.length||(e.value=[])}finally{a.value=!1}},p=async(t,o)=>{a.value=!0;try{const a=localStorage.getItem("token");if(!a)throw new Error("用户未登录");const r=c(a);if(!r||!r.customerId)throw new Error("用户信息不完整，请重新登录");const l=e.value.find((e=>e.cartItemId===t));if(!l)throw new Error("购物车项不存在");const s={cartItemId:Number(t),customerId:Number(r.customerId),productId:Number(l.id),quantity:Number(o),selectedOptions:""};await n.A.put(`http://algorineko.top:8080/api/customer/cart/${t}`,s,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}),l&&(l.quantity=o)}catch(l){r.value=l.response?.data?.message||l.message,console.error("更新购物车项失败:",l),await d()}finally{a.value=!1}},m=async o=>{a.value=!0;try{const a=localStorage.getItem("token");if(!a)throw new Error("用户未登录");await n.A.delete(`http://algorineko.top:8080/api/customer/cart/${o}`,{headers:{Authorization:`Bearer ${a}`}}),e.value=e.value.filter((e=>e.cartItemId!==o)),t.value.delete(o)}catch(l){r.value=l.response?.data?.message||l.message,console.error("删除购物车项失败:",l)}finally{a.value=!1}},v=async o=>{a.value=!0;try{const a=localStorage.getItem("token");if(!a)throw new Error("用户未登录");await Promise.all(o.map((e=>n.A.delete(`http://algorineko.top:8080/api/customer/cart/${e}`,{headers:{Authorization:`Bearer ${a}`}})))),e.value=e.value.filter((e=>!o.includes(e.cartItemId))),o.forEach((e=>t.value.delete(e)))}catch(l){r.value=l.response?.data?.message||l.message,console.error("批量删除购物车项失败:",l)}finally{a.value=!1}},g=(0,l.EW)((()=>e.value.reduce(((e,t)=>{const a=Number(t.price)||0,r=Number(t.quantity)||1;return e+a*r}),0))),h=(0,l.EW)((()=>e.value.reduce(((e,a)=>{if(t.value.has(a.cartItemId)){const t=Number(a.price)||0,r=Number(a.quantity)||1;return e+t*r}return e}),0))),I=(0,l.EW)((()=>e.value.filter((e=>t.value.has(e.cartItemId))))),y=e=>{t.value.has(e)?t.value.delete(e):t.value.add(e)},f=()=>{t.value.size===e.value.length?t.value.clear():e.value.forEach((e=>t.value.add(e.cartItemId)))},k=()=>t.value.clear();return{items:(0,l.EW)((()=>e.value)),totalPrice:g,selectedTotalPrice:h,selectedItems:(0,l.EW)((()=>t.value)),selectedItemsList:I,loading:(0,l.EW)((()=>a.value)),error:(0,l.EW)((()=>r.value)),fetchCart:d,updateQuantity:p,addItemToCart:i,removeItem:m,removeItems:v,toggleSelection:y,toggleSelectAll:f,clearSelected:k}}))},8611:function(e,t,a){a.r(t),a.d(t,{default:function(){return k}});a(4114);var r=a(6768),o=a(4232),l=a(144),n=a(1387),c=a(1219),s=a(5934),u=a(1147);const i={class:"product-detail"},d={class:"detail-content"},p={key:1,class:"no-images"},m={class:"product-info"},v={class:"price"},g={class:"action-group"},h={class:"description"};var I={__name:"ProductDetail",setup(e){const t=(0,n.lq)(),a=(0,n.rd)(),I=(0,s.x)(),y=(0,l.KR)({id:"",name:"",price:0,images:[],description:""}),f=(0,l.KR)(1),k=(0,l.KR)(!1),w=async e=>{if(e)try{const t=await u.A.get(`http://algorineko.top:8080/api/merchant/product/detail/${e}`),a=t.data;y.value={id:a.productId,name:a.productName,price:a.price,description:a.description,images:a.images||[]}}catch(t){c.nk.error("商品加载失败"),console.error("商品加载错误:",t)}else c.nk.error("无效的商品ID")};(0,r.sV)((()=>{const e=t.params.id;e&&w(e)}));const b=async()=>{k.value=!0;try{await I.addItemToCart({id:y.value.id,productName:y.value.name,price:y.value.price,quantity:f.value,image:y.value.images?.[0]||""}),await I.fetchCart(),c.nk.success("已加入购物车")}catch(e){console.error("加入购物车失败:",e);const t=e.message||"加入购物车失败";c.nk.error(t),401===e.response?.status&&a.push("/login")}finally{k.value=!1}};return(e,t)=>{const a=(0,r.g2)("el-button"),l=(0,r.g2)("el-image"),n=(0,r.g2)("el-carousel-item"),c=(0,r.g2)("el-carousel"),s=(0,r.g2)("el-empty"),u=(0,r.g2)("el-input-number"),I=(0,r.g2)("el-divider");return(0,r.uX)(),(0,r.CE)("div",i,[(0,r.bF)(a,{type:"text",onClick:t[0]||(t[0]=t=>e.$router.go(-1))},{default:(0,r.k6)((()=>t[2]||(t[2]=[(0,r.eW)("返回")]))),_:1,__:[2]}),(0,r.Lk)("div",d,[y.value.images?.length>0?((0,r.uX)(),(0,r.Wv)(c,{key:0,interval:4e3,height:"400px"},{default:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(y.value.images,((e,t)=>((0,r.uX)(),(0,r.Wv)(n,{key:t,style:{height:"400px"}},{default:(0,r.k6)((()=>[(0,r.bF)(l,{src:e,fit:"cover",style:{width:"100%",height:"100%"}},null,8,["src"])])),_:2},1024)))),128))])),_:1})):((0,r.uX)(),(0,r.CE)("div",p,[(0,r.bF)(s,{description:"暂无商品图片"})])),(0,r.Lk)("div",m,[(0,r.Lk)("h1",null,(0,o.v_)(y.value.name),1),(0,r.Lk)("p",v,"¥"+(0,o.v_)(y.value.price),1),(0,r.Lk)("div",g,[(0,r.bF)(u,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=e=>f.value=e),min:1},null,8,["modelValue"]),(0,r.bF)(a,{type:"primary",onClick:b,loading:k.value},{default:(0,r.k6)((()=>t[3]||(t[3]=[(0,r.eW)(" 加入购物车 ")]))),_:1,__:[3]},8,["loading"])]),(0,r.bF)(I),(0,r.Lk)("div",h,[t[4]||(t[4]=(0,r.Lk)("h3",null,"商品详情",-1)),(0,r.Lk)("p",null,(0,o.v_)(y.value.description||"暂无详情描述"),1)])])])])}}},y=a(1241);const f=(0,y.A)(I,[["__scopeId","data-v-1626a91b"]]);var k=f}}]);
//# sourceMappingURL=611.53e8b6f7.js.map