"use strict";(self["webpackChunkproject"]=self["webpackChunkproject"]||[]).push([[231],{231:function(e,a,l){l.r(a),l.d(a,{default:function(){return h}});l(4114),l(8111),l(2489),l(116),l(1701);var t=l(6768),r=l(4232),o=l(144),d=l(1219),i=l(5320),u=l(1147);const c={class:"product-section"},n={class:"table-header"},s={key:1,class:"no-image"},p={key:0},m={key:1,class:"error-text"},v={class:"image-upload-container"},g={class:"image-preview-list"},k={class:"image-actions"},b={key:0,class:"info-tip"};var f={__name:"ProductManagement",setup(e){const a=(0,o.KR)({keyword:""}),l=(0,o.KR)([]),f=(0,o.KR)(!1),w=(0,o.KR)({productName:"",categoryId:"",price:0,description:"",images:[""]}),y=(0,o.KR)(!1),h=(0,o.KR)(Number(localStorage.getItem("userId"))),_=(0,o.KR)([{id:"1005000",name:"居家"},{id:"1005002",name:"美食"},{id:"1010000",name:"服饰"},{id:"1011000",name:"母婴"},{id:"1013001",name:"个护"},{id:"1019000",name:"严选"},{id:"1043000",name:"数码"},{id:"109243029",name:"运动"},{id:"19999999",name:"杂项"}]),I=(0,t.EW)((()=>(l.value||[]).filter((e=>(e?.productName?.toLowerCase()||"").includes(a.value.keyword?.toLowerCase()||""))).map((e=>({...e,price:Number(e.price)||0}))))),F=(0,t.EW)((()=>y.value?"编辑商品":"新增商品")),C=e=>{const a=_.value.find((a=>a.id===e));return a?a.name:e||"未知分类"},V=()=>{w.value={productName:"",categoryId:"",price:0,description:"",images:[]},y.value=!1,f.value=!0},N=e=>{e?.productId?(w.value={...e,productId:e.productId},y.value=!0,f.value=!0):d.nk.warning("无效的商品数据")},x=e=>{if(!e)return;const a=2097152;if(e.size>a)return void d.nk.error("图片大小不能超过2MB");if(w.value.images.length>=5)return void d.nk.error("最多只能上传5张图片");const l=e.raw;if(l){const e=new FileReader;e.onload=e=>{w.value.images.push(e.target.result)},e.readAsDataURL(l)}},E=e=>{w.value.images.splice(e,1)},L=async()=>{if(!w.value.productName?.trim())return void d.nk.error("商品名称不能为空");if(!w.value.categoryId)return void d.nk.error("请选择商品分类");if(w.value.price<0)return void d.nk.error("价格不能为负数");let e=null;try{if(e=i.Ks.service({lock:!0,text:"保存中...",background:"rgba(0, 0, 0, 0.7)"}),y.value){const e=await u.A.put("http://algorineko.top:8080/api/merchant/product/update",{productId:w.value.productId,merchantId:h.value,productName:w.value.productName,description:w.value.description||"",price:w.value.price,categoryId:w.value.categoryId});if(!e.data.includes("成功"))throw new Error(e.data||"商品更新失败");d.nk.success("商品更新成功"),f.value=!1,await K()}else{const e=await u.A.post("http://algorineko.top:8080/api/merchant/product/add",{merchantId:h.value,productName:w.value.productName,description:w.value.description||"",price:w.value.price,categoryId:w.value.categoryId,images:w.value.images.length>0?w.value.images:[""]});if(!e.data.includes("成功"))throw new Error(e.data||"商品添加失败");d.nk.success("商品添加成功"),f.value=!1,await K()}}catch(a){const e=a.response?.data?.message||a.message||"操作失败";d.nk.error(`操作失败: ${e}`)}finally{e&&e.close()}},W=async e=>{if(!e)return void d.nk.warning("无效的商品ID");let a=null;try{a=i.Ks.service({lock:!0,text:"删除中...",background:"rgba(0, 0, 0, 0.7)"});const t=await u.A.delete(`http://algorineko.top:8080/api/merchant/product/delete?productId=${e}`);if("string"!==typeof t.data||!t.data.includes("成功"))throw new Error(t.data||"删除失败");{const a=l.value.findIndex((a=>a.productId===e));-1!==a&&l.value.splice(a,1),d.nk.success("商品删除成功")}}catch(t){const e=t.response?.data?.message||t.message||"删除失败";d.nk.error(`删除失败: ${e}`)}finally{a&&a.close()}},K=async()=>{let e=null;try{e=i.Ks.service({lock:!0,text:"加载商品数据...",background:"rgba(0, 0, 0, 0.7)"});const a=await u.A.get(`http://algorineko.top:8080/api/merchant/product/list?merchantId=${h.value}`);if(!Array.isArray(a.data))throw new Error("返回的数据格式不正确");l.value=a.data.map((e=>({productId:e.productId,productName:e.productName,categoryId:String(e.categoryId||""),price:e.price,description:e.description,images:e.images||[]})))}catch(a){const e=a.response?.data?.message||a.message||"加载商品失败";d.nk.error(`加载商品失败: ${e}`),l.value=[{productId:1,productName:"示例商品1",categoryId:"1005000",price:19.9,description:"这是一个示例商品",images:[]}]}finally{e&&e.close()}};return(0,t.sV)((()=>{K()})),(e,l)=>{const o=(0,t.g2)("el-input"),d=(0,t.g2)("el-button"),i=(0,t.g2)("el-image"),u=(0,t.g2)("el-table-column"),h=(0,t.g2)("el-table"),K=(0,t.g2)("el-form-item"),X=(0,t.g2)("el-option"),R=(0,t.g2)("el-select"),A=(0,t.g2)("el-input-number"),U=(0,t.g2)("el-upload"),$=(0,t.g2)("el-form"),z=(0,t.g2)("el-dialog");return(0,t.uX)(),(0,t.CE)("div",c,[l[16]||(l[16]=(0,t.Lk)("h2",null,[(0,t.Lk)("i",{class:"el-icon-goods"}),(0,t.eW)(" 商品管理")],-1)),(0,t.Lk)("div",n,[(0,t.bF)(o,{modelValue:a.value.keyword,"onUpdate:modelValue":l[0]||(l[0]=e=>a.value.keyword=e),placeholder:"输入商品名称搜索",style:{width:"300px"},clearable:"","prefix-icon":"el-icon-search"},null,8,["modelValue"]),(0,t.bF)(d,{type:"primary",icon:"el-icon-plus",onClick:V},{default:(0,t.k6)((()=>l[7]||(l[7]=[(0,t.eW)("新增商品")]))),_:1,__:[7]})]),(0,t.bF)(h,{data:I.value,border:"",style:{width:"100%"},class:"data-table"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{label:"商品图片",width:"120"},{default:(0,t.k6)((e=>[e.row.images&&e.row.images.length>0?((0,t.uX)(),(0,t.Wv)(i,{key:0,src:e.row.images[0],fit:"cover",style:{width:"80px",height:"80px","border-radius":"4px"}},{error:(0,t.k6)((()=>l[8]||(l[8]=[(0,t.Lk)("div",{class:"image-slot"},[(0,t.Lk)("i",{class:"el-icon-picture-outline"})],-1)]))),_:2},1032,["src"])):((0,t.uX)(),(0,t.CE)("div",s,"无图片"))])),_:1}),(0,t.bF)(u,{prop:"productName",label:"商品名称",width:"180"}),(0,t.bF)(u,{prop:"productId",label:"商品ID",width:"120"}),(0,t.bF)(u,{label:"分类",width:"120"},{default:(0,t.k6)((e=>[(0,t.eW)((0,r.v_)(C(e.row.categoryId)),1)])),_:1}),(0,t.bF)(u,{label:"价格",width:"120",align:"right"},{default:(0,t.k6)((e=>[(0,t.eW)(" ¥"+(0,r.v_)((e?.row?.price??0).toFixed(2)),1)])),_:1}),(0,t.bF)(u,{label:"操作",width:"200"},{default:(0,t.k6)((e=>[e?.row?((0,t.uX)(),(0,t.CE)("div",p,[(0,t.bF)(d,{size:"small",icon:"el-icon-edit",onClick:a=>N(e.row)},{default:(0,t.k6)((()=>l[9]||(l[9]=[(0,t.eW)("编辑")]))),_:2,__:[9]},1032,["onClick"]),(0,t.bF)(d,{size:"small",type:"danger",icon:"el-icon-delete",onClick:a=>W(e.row.productId)},{default:(0,t.k6)((()=>l[10]||(l[10]=[(0,t.eW)("删除")]))),_:2,__:[10]},1032,["onClick"])])):((0,t.uX)(),(0,t.CE)("span",m,"数据异常"))])),_:1})])),_:1},8,["data"]),(0,t.bF)(z,{modelValue:f.value,"onUpdate:modelValue":l[6]||(l[6]=e=>f.value=e),title:F.value,width:"800px"},{footer:(0,t.k6)((()=>[(0,t.bF)(d,{onClick:l[5]||(l[5]=e=>f.value=!1)},{default:(0,t.k6)((()=>l[14]||(l[14]=[(0,t.eW)("取消")]))),_:1,__:[14]}),(0,t.bF)(d,{type:"primary",onClick:L},{default:(0,t.k6)((()=>l[15]||(l[15]=[(0,t.eW)("保存")]))),_:1,__:[15]})])),default:(0,t.k6)((()=>[(0,t.bF)($,{model:w.value,"label-width":"100px"},{default:(0,t.k6)((()=>[(0,t.bF)(K,{label:"商品名称",required:""},{default:(0,t.k6)((()=>[(0,t.bF)(o,{modelValue:w.value.productName,"onUpdate:modelValue":l[1]||(l[1]=e=>w.value.productName=e),placeholder:"请输入商品名称"},null,8,["modelValue"])])),_:1}),(0,t.bF)(K,{label:"分类",required:""},{default:(0,t.k6)((()=>[(0,t.bF)(R,{modelValue:w.value.categoryId,"onUpdate:modelValue":l[2]||(l[2]=e=>w.value.categoryId=e),placeholder:"请选择分类",style:{width:"100%"}},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(_.value,(e=>((0,t.uX)(),(0,t.Wv)(X,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(K,{label:"价格",required:""},{default:(0,t.k6)((()=>[(0,t.bF)(A,{modelValue:w.value.price,"onUpdate:modelValue":l[3]||(l[3]=e=>w.value.price=e),min:0,precision:2,controls:!1,style:{width:"200px"}},null,8,["modelValue"]),l[11]||(l[11]=(0,t.Lk)("span",{class:"input-unit"},"元",-1))])),_:1,__:[11]}),(0,t.bF)(K,{label:"描述"},{default:(0,t.k6)((()=>[(0,t.bF)(o,{modelValue:w.value.description,"onUpdate:modelValue":l[4]||(l[4]=e=>w.value.description=e),type:"textarea",rows:4},null,8,["modelValue"])])),_:1}),(0,t.bF)(K,{label:"商品图片"},{default:(0,t.k6)((()=>[(0,t.Lk)("div",v,[(0,t.Lk)("div",g,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(w.value.images,((e,a)=>((0,t.uX)(),(0,t.CE)("div",{key:a,class:"image-preview-item"},[(0,t.bF)(i,{src:e,fit:"cover",class:"preview-image"},null,8,["src"]),(0,t.Lk)("div",k,[(0,t.bF)(d,{type:"danger",icon:"el-icon-delete",size:"small",circle:"",onClick:e=>E(a),disabled:y.value},null,8,["onClick","disabled"])])])))),128))]),(0,t.bF)(U,{action:"#",multiple:!0,"show-file-list":!1,"auto-upload":!1,"on-change":x,disabled:y.value,class:"image-upload-btn"},{default:(0,t.k6)((()=>[(0,t.bF)(d,{type:"primary",icon:"el-icon-plus",disabled:y.value},{default:(0,t.k6)((()=>l[12]||(l[12]=[(0,t.eW)("添加图片")]))),_:1,__:[12]},8,["disabled"]),l[13]||(l[13]=(0,t.Lk)("div",{class:"upload-tip"},"支持多图上传（最多5张，单张不超过2MB）",-1))])),_:1,__:[13]},8,["disabled"])]),y.value?((0,t.uX)(),(0,t.CE)("div",b,"编辑模式下不可修改图片")):(0,t.Q3)("",!0)])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title"])])}}},w=l(1241);const y=(0,w.A)(f,[["__scopeId","data-v-ab8c8c3e"]]);var h=y}}]);
//# sourceMappingURL=231.04160cd4.js.map